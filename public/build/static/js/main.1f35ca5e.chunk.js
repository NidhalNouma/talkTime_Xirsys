/*! For license information please see main.1f35ca5e.chunk.js.LICENSE.txt */
(this.webpackJsonpreactapp=this.webpackJsonpreactapp||[]).push([[0],{144:function(e,t,n){},191:function(e,t){},197:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=197},200:function(e,t){},202:function(e,t){},225:function(e,t){},227:function(e,t){},255:function(e,t){},257:function(e,t){},258:function(e,t){},263:function(e,t){},265:function(e,t){},271:function(e,t){},273:function(e,t){},292:function(e,t){},304:function(e,t){},307:function(e,t){},321:function(e,t,n){"use strict";n.r(t);var s=n(0),o=n.n(s),i=n(138),r=n.n(i),c=(n(144),n(6)),a=n(139),l=n.n(a),u=n(71),h=n.n(u),p=n(3);var f=function(e){var t=e.stream,n=e.lstream,o=Object(s.useState)(new h.a),i=Object(c.a)(o,1)[0],r=Object(s.useState)(new h.a),a=Object(c.a)(r,1)[0],l=Object(s.useState)(0),u=Object(c.a)(l,2),f=u[0],d=u[1],g=Object(s.useRef)(null);return Object(s.useEffect)((function(){var e=setTimeout((function(){d((function(e){return e+1}))}),1e3);return function(){return clearTimeout(e)}}),[f]),Object(s.useEffect)((function(){return t&&t.active&&i.fromStream(t,"wave",{type:"shine",colors:["rgba(149, 54, 64,1)","white","blue"]}),n&&n.active&&a.fromStream(n,"lwave",{type:"shine",colors:["rgba(45, 134, 233, 1)","white","blue"]}),console.log("Start streaming audio ...,",t),g.current.srcObject=t,function(){i.stopStream(),a.stopStream()}}),[]),Object(p.jsxs)("div",{children:[Object(p.jsx)("canvas",{id:"wave"}),Object(p.jsx)("br",{}),Object(p.jsx)("canvas",{id:"lwave"}),Object(p.jsx)("audio",{ref:g,style:{display:"none"},volume:"true",autoPlay:!0})]})},d=n(72),g=n.n(d);var v=function(e,t){var n=Object(s.useState)(new Object),o=Object(c.a)(n,1)[0];return Object(s.useEffect)((function(){var n=o.ice=function(e,t){t||(t={}),this.info=t,this.apiUrl=e||"/webrtc",this.evtListeners={},this.iceServers=null,this.apiUrl&&(this.info.ident&&this.info.secret?this.doICE(this.info.ident,this.info.secret):this.doICE())};n.prototype.onICEList="onICEList",n.prototype.doICE=function(e,t){console.log("*ice*  doICE: ",this.apiUrl+"/_turn"+this.channelPath);var n=this,s=new XMLHttpRequest;s.onreadystatechange=function(e){if(4===s.readyState&&200===s.status){var t=JSON.parse(s.responseText);console.log("*ice*  response: ",t),n.iceServers=n.filterPaths(t.v.iceServers),n.emit(n.onICEList)}};var o=this.apiUrl+"/_turn/"+this.channelPath;s.open("PUT",o,!0),e&&t&&s.setRequestHeader("Authorization","Basic "+btoa("".concat(e,":").concat(t))),s.send()},n.prototype.filterPaths=function(e){var t,n=e.length,s=[];for(t=0;t<n;t++){var o=e[t],i=o.url;i&&(o.urls=i,delete o.url),s.push(o)}return s},n.prototype.on=function(e,t){if(!e||!t)return console.log("error:  missing arguments for on event."),!1;this.evtListeners[e]||(this.evtListeners[e]=[]),this.evtListeners[e].push(t)},n.prototype.off=function(e,t){if(!this.evtListeners.hasOwnProperty(e))return!1;var n=this.evtListeners[e].indexOf(t);return-1!==n&&(this.evtListeners[e].splice(n,1),!0)},n.prototype.emit=function(e,t){var n=this.evtListeners[e];if(n)for(var s=n.length,o=0;o<s;o++){n[o].apply(this,[{type:this.onICEList}])}},console.log("$xirsys.ice Loaded Successfuly!!!"),n=null;var s=o.signal=function(e,t,n){n||(n={}),this.info=n,this.sig=null,this.tmpToken=null,this.sigHostPath=null,this.pendListeners=[],this.heartbeat=null,this.evtListeners={},this.userName=t||null,this.apiUrl=e||"/webrtc",this.connectTo(n.channel?n.channel:"")};s.prototype.ver="v2",s.prototype.keepAliveInt=800,s.prototype.connected=!1,s.prototype.close=function(){console.log("close ",this.sig),this.heartbeat&&this.stopHeart(),this.sig&&this.sig.close()},s.prototype.connectTo=function(e){if(this.channelPath=e?this.cleanChPath(e):"",console.log("connectTo: ",this.channelPath),this.sig){this.close();var t=this;setTimeout((function(){t.doToken()}),800)}else this.apiUrl?this.info.ident&&this.info.secret?this.doToken(this.info.ident,this.info.secret):this.doToken():console.log("Error: Could connect signal!");return!0},s.prototype.doToken=function(e,t){var n=this.apiUrl+"/_token"+this.channelPath+"?k="+this.userName;console.log("*signal*  PUT doToken to "+n);var s=this,o={};e&&t&&(o.Authorization="Basic "+btoa(e+":"+t)),g.a.ajax({url:n,type:"PUT",dataType:"json",headers:o,error:function(e){console.log("*signal*  error: ",e)},success:function(e){s.tmpToken=e.v,"no_namespace"!==s.tmpToken?(console.log("*signal*  token: ",s.tmpToken),s.info.ident&&s.info.secret?s.doSignal(s.info.ident,s.info.secret):s.doSignal()):console.log("*signal*  fail: ",s.tmpToken)}})},s.prototype.doSignal=function(t,n){console.log("*signal*  GET doSignal to "+this.apiUrl+"/_host"+this.channelPath+"?type=signal&k="+this.userName);var s=this,o=this.info.channel?this.apiUrl+"/_host"+this.channelPath+"?type=signal&k="+this.userName:this.apiUrl+"/_host?type=signal&k="+this.userName,i={};t&&n&&(i.Authorization="Basic "+btoa(t+":"+n)),g.a.ajax({url:o,type:"GET",dataType:"json",headers:i,error:function(e){console.log("*signal*  error: ",e)},success:function(t){s.host=t.v+"/"+s.ver+"/"+s.tmpToken,console.log("KKKKKKKKK ",t),t.randomUser&&(s.randomUser=t.randomUser,e(t.randomUser)),t.users&&(s.users=t.users),console.log("signal host: ",s.host),s.setupSocket()}})},s.prototype.setupSocket=function(){var e=this;console.log("*signal*  setupSocket to "+this.host);var t=this;this.sig=new WebSocket(this.host),this.sig.addEventListener("open",(function(e){t.startHeart(),t.connected=!0})),this.sig.addEventListener("close",(function(n){e.heartbeat&&t.stopHeart(),t.connected=!1,e.sig=null}));var n=this.pendListeners.length;if(n>0){for(var s=0;s<n;s++){var o=this.pendListeners[s];this.on(o.event,o.f)}this.pendListeners=[]}this.sig.addEventListener("message",(function(n){var s=JSON.parse(n.data);console.log("*signal*  signal message! ",s);var o=s.p,i=s.m,r=i.o,c=i.f;if(c){var a=c.split("/");c=a[a.length-1]}switch(r){case"peers":var l=i.f.lastIndexOf("__sys__");l>-1&&!e.channelPath&&(t.channelPath=i.f.substring(0,l),console.log("*signal*  channelPath ",e.channelPath));break;case"peer_connected":case"peer_removed":break;case"message":var u=o.msg;u.f=c,"candidate"!==u.type&&"offer"!==u.type&&"answer"!==u.type&&"custom"!==u.type||t.emit(u.type,u)}t.emit("message",n.data)}))},s.prototype.sendMessage=function(e,t,n){if(n||(n={}),console.log("*signal*  sendMessage: ",e,", to: ",t," info: ",n),!(void 0===e||e.length<1)){var s={t:"u",m:{f:this.channelPath+this.userName,o:n.m_event?n.m_event:"message"},p:{msg:e}};return t&&(s.m.t=t),this.sig.send(JSON.stringify(s)),s}},s.prototype.cleanChPath=function(e){return 0!==e.indexOf("/")&&(e="/"+e),e.lastIndexOf("/")===e.length-1&&(e=e.substr(0,e.lastIndexOf("/"))),e},s.prototype.startHeart=function(){this.heartbeat&&clearInterval(this.heartbeat);var e=this;this.heartbeat=setInterval((function(){e.sig.send("ping")}),o.signal.keepAliveInt)},s.prototype.stopHeart=function(){clearInterval(this.heartbeat),this.heartbeat=null,console.log("signal closed!")},s.prototype.on=function(e,t){if(!e||!t)return console.log('error:  missing arguments for "on" event.'),!1;this.evtListeners[e]||(this.evtListeners[e]=[]),this.evtListeners[e].push(t)},s.prototype.off=function(e,t){if(!this.evtListeners.hasOwnProperty(e))return!1;var n=this.evtListeners[e].indexOf(t);return-1!==n&&(this.evtListeners[e].splice(n,1),!0)},s.prototype.emit=function(e,t){var n=this.evtListeners[e];if(n)for(var s=n.length,o=0;o<s;o++){n[o].apply(this,[{type:e,data:t}])}},console.log("$xirsys.signal Loaded Successfuly!!!"),s=null;var i=o.p2p=function(e,t,n,s){s||(s={}),console.log("*p2p*  servers: ",n,", mediaStream: ",t,", sig: ",e,", info: ",s),this.evtListeners={},this.pc=null;var o=this;this.sig=e,this.sig&&(this.sig.on("candidate",(function(e){o.receiveCandidate(e)})),this.sig.on("offer",(function(e){o.receiveOffer(e)})),this.sig.on("answer",(function(e){o.receiveAnswer(e)}))),this.servers=n||{},this.forceTurn=null!=s.forceTurn&&s.forceTurn,this.stream=t,this.remotePeerID=null,this.remoteStreams={},this.isCaller=null,this.autoAnswer=null==s.autoAnswer||s.autoAnswer};i.prototype.peerConnSuccess="peer.connect.success",i.prototype.peerConnRequest="peer.connect.request",i.prototype.iceDisconnected="peer.connect.disconnected",i.prototype.close=function(){this.pc&&this.pc.close(),this.remoteStreams={},this.remotePeerID=null,this.isCaller=null},i.prototype.updateMediaStream=function(e){if(console.log("*p2p*  updateMediaStream ",e),this.stream=e,this.pc&&this.stream){this.isCaller=!0;var t=this;this.stream.getTracks().forEach((function(e){t.pc.addTrack(e,t.stream)})),this.pc.createOffer().then((function(e){t.setLocalAndSendMessage(e)})).catch((function(e){t.onCreateSessionDescriptionError(e)}))}return!0},i.prototype.callPeer=function(e){if(console.log("*p2p*  callPeer ",e),this.createPeerConnection()&&this.stream){console.log("this pc =>> ",this.pc,this),this.isCaller=!0;var t=this;this.remotePeerID=e,this.stream.getTracks().forEach((function(e){t.pc.addTrack(e,t.stream)})),this.pc.createOffer().then((function(e){t.setLocalAndSendMessage(e)})).catch((function(e){t.onCreateSessionDescriptionError(e)}))}},i.prototype.receiveCandidate=function(e){if(!this.pc)return!1;var t=e.data,n=new RTCIceCandidate(t);this.pc.addIceCandidate(n)},i.prototype.acceptRequest=function(e){this.receiveOffer(e,!0)},i.prototype.receiveOffer=function(e,t){var n=!0===t,s=e.data;if(console.log("*p2p*  receiveOffer ",s," remotePeerID = ",this.remotePeerID,"autoAnswer",this.autoAnswer),!this.autoAnswer&&!n)return console.log("needs verification!"),void this.emit(this.peerConnRequest,e.data);var o=this;!this.remotePeerID&&s.f&&(this.remotePeerID=s.f),console.log("*p2p*  !pc ",this.pc,", !iscaller: ",this.isCaller),this.pc||this.isCaller||this.createPeerConnection()&&this.stream&&this.stream.getTracks().forEach((function(e){o.pc.addTrack(e,o.stream)}));try{this.pc.setRemoteDescription(new RTCSessionDescription(s))}catch(i){console.error("**P2p** setRemoteDescription offer ,",i)}this.pc.createAnswer().then((function(e){o.setLocalAndSendMessage(e)})).catch((function(e){o.onCreateSessionDescriptionError(e)}))},i.prototype.receiveAnswer=function(e){var t=e.data;if(console.log("*p2p*  receiveAnswer ",t),this.remotePeerID===t.f)try{this.pc.setRemoteDescription(new RTCSessionDescription(t))}catch(n){console.error("**P2p** setRemoteDescription answer ,",n)}},i.prototype.createPeerConnection=function(){console.log("*p2p*  createPeerConnection ");try{var e=this;return console.log("RTCPeerConnection servers:  ",this.servers),this.pc=new RTCPeerConnection(this.servers),this.pc.ontrack=function(e){e.streams[0].getTracks().forEach((function(e){console.log(t,"rstreeeeem"),t.addTrack(e)}))},this.pc.onicecandidate=function(t){var n=t.candidate;n&&(e.forceTurn&&-1===n.candidate.indexOf("typ relay")?n=null:e.sig.sendMessage({type:"candidate",candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex},e.remotePeerID))},this.pc.onremovestream=function(e){return console.log("*p2p*  onremovestream ",e)},this.pc.onconnectionstatechange=function(t){return console.log("*p2p*  onconnectionstatechange: "+e.pc.connectionState)},this.pc.oniceconnectionstatechange=function(t){switch(console.log("*p2p*  oniceconnectionstatechange: "+e.pc.iceConnectionState),e.pc.iceConnectionState){case"checking":case"connected":break;case"disconnected":e.emit(e.iceDisconnected,e.remotePeerID)}},!0}catch(n){return console.log("Failed to create PeerConnection, exception: "+n.message),!1}},i.prototype.hangup=function(e){console.log("*p2p*  hangup",e),this.pc.close(),this.remoteStreams[e]=null,this.remotePeerID=null,this.isCaller=!1},i.prototype.addTrack=function(e){this.remoteStreams[this.remotePeerID]=e,this.emit(this.peerConnSuccess,this.remotePeerID),this.isCaller=!1},i.prototype.addRemoteStream=function(e){this.remoteStreams[this.remotePeerID]=e,this.emit(this.peerConnSuccess,this.remotePeerID),this.isCaller=!1},i.prototype.getLiveStream=function(e){return this.remoteStreams[e]},i.prototype.setLocalAndSendMessage=function(e){console.log("*p2p*  setLocalAndSendMessage sending message",e),this.pc.setLocalDescription(e),console.log("sendMessage for: ",this.remotePeerID),this.sig.sendMessage(e,this.remotePeerID)},i.prototype.onCreateSessionDescriptionError=function(e){console.log("Failed to create session description: ",e)},i.prototype.on=function(e,t){if(!e||!t)return console.log("error:  missing arguments for on event."),!1;this.evtListeners[e]||(this.evtListeners[e]=[]),this.evtListeners[e].push(t)},i.prototype.off=function(e,t){console.log("off"),this.evtListeners.push(t)},i.prototype.emit=function(e,t){var n=this.evtListeners[e];if(n)for(var s=n.length,o=0;o<s;o++){n[o].apply(this,[{type:e,data:t}])}},console.log("$xirsys.p2p Loaded Successfuly!!!"),i=null}),[]),{xirsys:o}};n(171);var m=function(){var e=Object(s.useState)(null),t=Object(c.a)(e,2),n=t[0],o=t[1],i=Object(s.useState)(new MediaStream),r=Object(c.a)(i,2),a=r[0],l=(r[1],Object(s.useState)(null)),u=Object(c.a)(l,2),h=u[0],p=u[1],f=Object(s.useState)(null),d=Object(c.a)(f,2),g=d[0],m=d[1],b=Object(s.useState)(!1),j=Object(c.a)(b,2),O=j[0],y=j[1],S=Object(s.useState)(null),C=Object(c.a)(S,2),P=C[0],L=C[1],T=Object(s.useState)(null),w=Object(c.a)(T,2),k=w[0],E=w[1],I=Object(s.useState)(null),x=Object(c.a)(I,2),D=x[0],M=x[1],R=Object(s.useState)(!1),U=Object(c.a)(R,2),A=U[0],N=U[1],_=Object(s.useState)(!1),K=Object(c.a)(_,2),F=K[0],H=K[1],q=v(m,a).xirsys,B=Object(s.useState)(null),J=Object(c.a)(B,2),z=J[0],$=J[1],G=Object(s.useState)(!1),V=Object(c.a)(G,2),W=V[0],X=V[1];function Q(e){console.log("onICE ",e),e.type===D.onICEList&&function(){console.log("getMyMedia()");var e={audio:!0};navigator.mediaDevices.getUserMedia(e).then((function(e){!function(e){console.log("*main*  setLocalStream & Video obj ",e),o(e)}(e)})).catch((function(e){console.log("Could not get Media: ",e),alert("Could not get Media!! Please check your camera and mic...")}))}()}function Y(){k.on("message",(function(e){var t=JSON.parse(e.data);console.log("message log ,",e,z);var s=t.p,o=t.m,i=o.o,r=o.f;if(r){var c=r.split("/");r=c[c.length-1]}switch(i){case"peers":if(function(){console.log("* onReady!");var e="true"===te("isTURN");console.log("isTURN ",e),L(new z.p2p(k,n,D?{iceServers:D.iceServers}:{},{forceTurn:e}))}(),g)s.users.indexOf(g)>-1&&N(!0);break;case"peer_removed":r===g&&ee()}}))}function Z(e){console.log("*main*  onStartCall ",e);var t,n=e.data;console.log("peer scall ",P),t=P.getLiveStream(n),console.log("*main*  setRemoteStream & Video obj ",t),console.log(z.pc,"PC"),y(!0),m(n),H(!0)}function ee(){console.log("*main*  onStopCall "),F&&P.hangup(g),console.log(z)}function te(e){var t=window.location.href,n=new URL(t).searchParams.get(e);return n||null}Object(s.useEffect)((function(){W&&($(q),console.log("reload ...."),X(!1))}),[W]),Object(s.useEffect)((function(){z&&ne()}),[z]),Object(s.useEffect)((function(){n&&(k||E(new z.signal("/webrtc",h,{channel:""})),P&&P.updateMediaStream(n))}),[n]),Object(s.useEffect)((function(){P&&(P.on(P.peerConnSuccess,Z),console.log("peer ",P)),console.log("peer ",P)}),[P]),Object(s.useEffect)((function(){A&&(g?(console.log("Calling "+g),P.callPeer(g)):console.log("Error","A remote peer was not found!"),N(!1))}),[A]),Object(s.useEffect)((function(){k&&Y()}),[k]),Object(s.useEffect)((function(){D&&D.on(D.onICEList,Q)}),[D]),Object(s.useEffect)((function(){console.log("remote Id == ",g),k&&g&&g!==h&&Y()}),[g]);var ne=function(){console.log("pretty loaded!!"),E(null),h||p(function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"user")+e()+e()}());var e=te("callid");e&&m(e),console.log("doICE "),D||M(new z.ice("/webrtc",{channel:""})),W&&X((function(e){return!e}))};return{onLoad:ne,lstream:n,rstream:a,onStopCall:ee,startCall:O,setReload:X,reset:function(){$(null),H(!1),m(null),y(!1),M(null),E(null),L(null)}}};var b=function(e){var t=e.type,n=void 0===t?0:t,o=e.answer,i=m(),r=(i.onLoad,i.lstream),a=i.rstream,u=i.onStopCall,h=i.startCall,d=i.setReload,g=i.reset;Object(s.useEffect)((function(){console.log("Type is ==> ",n,h),0===n&&(j(r),j(a),h&&u()),1===n&&(g(),d(!0))}),[n]),Object(s.useEffect)((function(){h&&o()}),[h]);var v=Object(s.useState)(null),b=Object(c.a)(v,2),O=b[0],y=b[1],S=Object(s.useState)(0),C=Object(c.a)(S,2),P=C[0],L=C[1],T=function(){L((function(e){return e+1}))};return Object(s.useEffect)((function(){1===n?y(setInterval(T,1e3)):O&&(clearInterval(O),y(null))}),[n,a]),Object(s.useEffect)((function(){a&&(a.active?(console.log("answer call"),o()):a.active)}),[P]),1===n?Object(p.jsx)(l.a,{type:"Bars",color:"rgba(102, 193, 113, 1)",height:80,width:80}):2===n&&a?Object(p.jsx)(f,{stream:a,lstream:r}):Object(p.jsx)("div",{})};function j(e){e&&e.getTracks().forEach((function(t){t.stop(),console.log("st",e)}))}var O=function(){var e=Object(s.useState)(0),t=Object(c.a)(e,2),n=t[0],o=t[1],i=Object(s.useState)("Call"),r=Object(c.a)(i,2),a=r[0],l=r[1];return{state:n,click:function(){0===n&&(o(1)||l("Dialling")),1===n&&(o(0)||l("Call")),2===n&&(o(0)||l("Call"))},btnText:a,answer:function(){o(2),l("End")}}};var y=function(){var e=O(),t=e.state,n=e.click,s=e.btnText,o=e.answer;return Object(p.jsxs)("div",{className:"App",children:[Object(p.jsx)("div",{className:"logo",children:Object(p.jsx)("h4",{children:"TalkTime"})}),Object(p.jsx)("div",{children:Object(p.jsx)("h5",{children:"Find someone to talk to."})}),Object(p.jsx)("div",{className:"audio-animation",children:Object(p.jsx)(b,{type:t,answer:o})}),Object(p.jsx)("div",{className:"button",children:Object(p.jsx)("button",{onClick:n,className:s,children:s})}),Object(p.jsxs)("div",{className:"footer",children:[Object(p.jsx)("a",{href:"/privacy",children:"Privacy Policy"})," | ",Object(p.jsx)("a",{href:"/terms",children:"Terms"})]})]})},S=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,322)).then((function(t){var n=t.getCLS,s=t.getFID,o=t.getFCP,i=t.getLCP,r=t.getTTFB;n(e),s(e),o(e),i(e),r(e)}))};r.a.render(Object(p.jsx)(o.a.StrictMode,{children:Object(p.jsx)(y,{})}),document.getElementById("root")),S()}},[[321,1,2]]]);
//# sourceMappingURL=main.1f35ca5e.chunk.js.map
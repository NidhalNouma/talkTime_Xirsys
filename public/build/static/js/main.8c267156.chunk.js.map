{"version":3,"sources":["component/WaveAudio.js","hooks/Xirsys.js","hooks/Main1.js","component/Audio.js","hooks/Call.js","App.js","reportWebVitals.js","index.js"],"names":["WaveAudio","stream","lstream","useState","Wave","wave","lwave","rel","setRel","audio","useRef","useEffect","interval","setTimeout","r","clearTimeout","active","fromStream","type","colors","console","log","current","srcObject","stopStream","id","ref","style","display","volume","autoPlay","Xirsys","setRandomUser","rstream","Object","$xirsys","_md","media","info","this","evtListeners","getLocalDevices","then","devices","updateDevices","prototype","localDevices","localStream","DEVICES_UPDATED","ON_LOCAL_STREAM","getUserMedia","constraints","setLocalStream","cbSuccess","cbFail","video","own","navigator","mediaDevices","str","emit","enumerateDevices","list","arguments","length","items","audioin","videoin","forEach","device","deviceId","defaults","push","kind","on","sEvent","cbFunc","off","hasOwnProperty","index","indexOf","splice","data","handlers","i","l","apply","_ice","ice","apiUrl","channelPath","channel","cleanChPath","iceServers","ident","secret","doICE","onICEList","xhr","XMLHttpRequest","onreadystatechange","$evt","readyState","status","res","JSON","parse","responseText","filterPaths","v","path","open","setRequestHeader","btoa","send","arr","a","item","url","urls","lastIndexOf","substr","_sig","signal","userName","sig","tmpToken","sigHostPath","pendListeners","heartbeat","connectTo","ver","keepAliveInt","connected","close","stopHeart","doToken","_headers","$","ajax","dataType","headers","error","success","doSignal","host","randomUser","users","setupSocket","WebSocket","addEventListener","evt","startHeart","event","f","msg","pkt","payload","p","meta","m","msgEvent","o","fromPeer","split","sysNum","substring","sendMessage","toPeer","undefined","t","m_event","stringify","clearInterval","setInterval","_p2p","p2p","mediaStream","servers","pc","receiveCandidate","receiveOffer","receiveAnswer","forceTurn","remotePeerID","remoteStreams","isCaller","autoAnswer","peerConnSuccess","peerConnRequest","iceDisconnected","updateMediaStream","getTracks","track","addTrack","createOffer","desc","setLocalAndSendMessage","catch","err","onCreateSessionDescriptionError","callPeer","custID","createPeerConnection","iceCandidate","rtcIceCandidate","RTCIceCandidate","addIceCandidate","acceptRequest","offer","isVerfied","verified","setRemoteDescription","RTCSessionDescription","e","createAnswer","RTCPeerConnection","ontrack","streams","onicecandidate","cand","candidate","sdpMid","sdpMLineIndex","onremovestream","onconnectionstatechange","connectionState","oniceconnectionstatechange","iceConnectionState","message","hangup","callId","addRemoteStream","remoteStream","getLiveStream","sessionDescription","setLocalDescription","xirsys","Main","mediaConstraints","setLStream","MediaStream","username","setUsername","remoteCallID","setRemoteCallID","startCall","setStartCall","peer","setPeer","setSig","setMedia","setIce","call","setCall","inCall","setInCall","onICE","isTURN","getURLParameter","onReady","onStopCall","onStartCall","remoteId","onMediaDevices","mics","cams","camList","micList","empty","append","groupId","label","html","name","url_string","window","location","href","c","URL","searchParams","get","alert","onLoad","s4","Math","floor","random","toString","guid","urlName","Audio","answer","stopAudioOnly","setInter","cnt","setCnt","intervalAnswer","color","height","width","stop","Call","state","setState","btnText","setBtnText","click","App","className","onClick","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.8c267156.chunk.js","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport Wave from \"wave-visualizer\";\n\nfunction WaveAudio({ stream, lstream }) {\n  const [wave] = useState(new Wave());\n  const [lwave] = useState(new Wave());\n  const [rel, setRel] = useState(0);\n\n  const audio = useRef(null);\n\n  useEffect(() => {\n    const interval = setTimeout(() => {\n      setRel((r) => r + 1);\n      // console.log(rel);\n    }, 1000);\n    return () => clearTimeout(interval);\n  }, [rel]);\n\n  useEffect(() => {\n    stream &&\n      stream.active &&\n      wave.fromStream(stream, \"wave\", {\n        type: \"shine\",\n        colors: [\"rgba(149, 54, 64,1)\", \"white\", \"blue\"],\n      });\n\n    lstream &&\n      lstream.active &&\n      lwave.fromStream(lstream, \"lwave\", {\n        type: \"shine\",\n        colors: [\"rgba(45, 134, 233, 1)\", \"white\", \"blue\"],\n      });\n\n    console.log(\"Start streaming audio ...,\", stream);\n\n    audio.current.srcObject = stream;\n    return () => {\n      wave.stopStream();\n      lwave.stopStream();\n    };\n  }, []);\n\n  return (\n    <div>\n      <canvas id=\"wave\"></canvas>\n      <br />\n      <canvas id=\"lwave\"></canvas>\n      <audio\n        ref={audio}\n        style={{ display: \"none\" }}\n        volume=\"true\"\n        autoPlay\n      ></audio>\n    </div>\n  );\n}\n\nexport default WaveAudio;\n","import $ from \"jquery\";\nimport { useState, useEffect } from \"react\";\n\n// Media\n\nfunction Xirsys(setRandomUser, rstream) {\n  const [$xirsys] = useState(new Object());\n\n  useEffect(() => {\n    let _md = ($xirsys.media = function (info) {\n      if (!info) info = {};\n      console.log(\"*media*  info: \", info);\n      //internal values\n      this.info = info;\n      this.evtListeners = {};\n      this.getLocalDevices().then((devices) => {\n        this.updateDevices(devices);\n      });\n    });\n\n    _md.prototype.localDevices = null;\n    _md.prototype.localStream = null;\n\n    //events\n    _md.prototype.DEVICES_UPDATED = \"devicesUpdated\";\n    _md.prototype.ON_LOCAL_STREAM = \"onLocalStream\";\n\n    /* PUBLIC */\n\n    _md.prototype.getUserMedia = function (\n      constraints,\n      setLocalStream,\n      cbSuccess,\n      cbFail\n    ) {\n      if (!constraints) constraints = { audio: true, video: true };\n      //return promise\n      var own = this;\n      return navigator.mediaDevices.getUserMedia(constraints).then((str) => {\n        own.localStream = str;\n        setLocalStream(str);\n        own.emit(own.ON_LOCAL_STREAM, str);\n        return str;\n      });\n      /* .catch(err => { \n              console.log('Could not get Media: ', err);\n              throw err;\n          }); */\n    };\n\n    _md.prototype.getLocalDevices = function () {\n      if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) {\n        console.log(\n          \"Error: Could not get list of media devices!  This might not be supported by this browser.\"\n        );\n        return;\n      }\n      let d = navigator.mediaDevices.enumerateDevices();\n      return d;\n    };\n\n    /* PRIVATE */\n\n    _md.prototype.updateDevices = function (list) {\n      console.log(\"*media*  updateDevices \", list);\n      if (arguments.length === 0) return;\n      //set local list. dispatch event that list is updated.\n      let items = { audioin: [], videoin: [] };\n\n      list.forEach((device) => {\n        //console.log('device: ',device);\n        if (device.deviceId === \"default\") {\n          if (!items.defaults) items.defaults = [];\n          items.defaults.push(device);\n          return;\n        }\n        switch (device.kind) {\n          case \"audioinput\":\n            if (device.deviceId !== \"default\") {\n              items.audioin.push(device);\n            }\n            break;\n          case \"videoinput\":\n            if (device.deviceId !== \"default\") {\n              items.videoin.push(device);\n            }\n            break;\n          default:\n            break;\n        }\n      });\n      //console.log('Items list: ',items);\n      this.localDevices = items;\n      this.emit(this.DEVICES_UPDATED, this.localDevices);\n    };\n\n    //UTILS\n\n    /* EVENTS */\n\n    _md.prototype.on = function (sEvent, cbFunc) {\n      //console.log('*p2group*  on ',sEvent,', func: '+cbFunc);\n      if (!sEvent || !cbFunc) {\n        console.log('error:  missing arguments for \"on\" event.');\n        return false;\n      }\n      //if event does not exist create it and give it an array for listeners.\n      if (!this.evtListeners[sEvent]) this.evtListeners[sEvent] = [];\n      //add listener to event.\n      this.evtListeners[sEvent].push(cbFunc);\n    };\n    _md.prototype.off = function (sEvent, cbFunc) {\n      if (!this.evtListeners.hasOwnProperty(sEvent)) return false; //end\n\n      let index = this.evtListeners[sEvent].indexOf(cbFunc);\n      if (index !== -1) {\n        this.evtListeners[sEvent].splice(index, 1);\n        return true; //else end here.\n      }\n      return false; //else end here.\n    };\n\n    _md.prototype.emit = function (sEvent, data) {\n      let handlers = this.evtListeners[sEvent];\n      if (!!handlers) {\n        let l = handlers.length,\n          i;\n        for (i = 0; i < l; i++) {\n          let item = handlers[i];\n          item.apply(this, [{ type: sEvent, data: data }]);\n        }\n      }\n    };\n\n    console.log(\"$xirsys.media Loaded Successfuly!!!\");\n    _md = null;\n\n    //Ice\n\n    var _ice = ($xirsys.ice = function (apiUrl, info) {\n      if (!info) info = {};\n      this.info = info;\n      this.apiUrl = !!apiUrl ? apiUrl : \"/webrtc\";\n      this.evtListeners = {};\n\n      //path to channel we are sending data to.\n      this.channelPath = !!info.channel ? this.cleanChPath(info.channel) : \"\";\n\n      this.iceServers = null;\n      if (!!this.apiUrl) {\n        if (this.info.ident && this.info.secret) {\n          this.doICE(this.info.ident, this.info.secret); //first get our token.\n        } else {\n          this.doICE();\n        }\n      }\n    });\n\n    _ice.prototype.onICEList = \"onICEList\";\n\n    _ice.prototype.doICE = function (ident, secret) {\n      console.log(\"*ice*  doICE: \", this.apiUrl + \"/_turn\" + this.channelPath);\n      var own = this;\n      var xhr = new XMLHttpRequest();\n      xhr.onreadystatechange = function ($evt) {\n        if (xhr.readyState === 4 && xhr.status === 200) {\n          var res = JSON.parse(xhr.responseText);\n          console.log(\"*ice*  response: \", res);\n          own.iceServers = own.filterPaths(res.v.iceServers);\n\n          own.emit(own.onICEList);\n        }\n      };\n      var path = this.apiUrl + \"/_turn/\" + this.channelPath;\n      xhr.open(\"PUT\", path, true);\n      if (ident && secret)\n        xhr.setRequestHeader(\n          \"Authorization\",\n          \"Basic \" + btoa(`${ident}:${secret}`)\n        );\n      xhr.send();\n    };\n\n    //check for depricated RTCIceServer \"url\" property, needs to be \"urls\" now.\n    _ice.prototype.filterPaths = function (arr) {\n      var l = arr.length,\n        i;\n      var a = [];\n      for (i = 0; i < l; i++) {\n        var item = arr[i];\n        var v = item.url;\n        if (!!v) {\n          item.urls = v;\n          delete item.url;\n        }\n        a.push(item);\n      }\n      return a;\n    };\n\n    //formats the custom channel path how we need it.\n    _ice.prototype.cleanChPath = function (path) {\n      //has slash at front\n      console.log(\"cleanChPath path recv: \" + path);\n      if (path.indexOf(\"/\") !== 0) path = \"/\" + path;\n      if (path.lastIndexOf(\"/\") === path.length - 1)\n        path = path.substr(0, path.lastIndexOf(\"/\"));\n      console.log(\"cleanChPath new path: \" + path);\n      return path;\n    };\n\n    _ice.prototype.on = function (sEvent, cbFunc) {\n      //console.log('*ice*  on ',sEvent);\n      if (!sEvent || !cbFunc) {\n        console.log(\"error:  missing arguments for on event.\");\n        return false;\n      }\n      if (!this.evtListeners[sEvent]) this.evtListeners[sEvent] = [];\n      this.evtListeners[sEvent].push(cbFunc);\n    };\n    _ice.prototype.off = function (sEvent, cbFunc) {\n      if (!this.evtListeners.hasOwnProperty(sEvent)) return false; //end\n\n      var index = this.evtListeners[sEvent].indexOf(cbFunc);\n      if (index !== -1) {\n        this.evtListeners[sEvent].splice(index, 1);\n        return true; //else end here.\n      }\n      return false; //else end here.\n    };\n\n    _ice.prototype.emit = function (sEvent, data) {\n      var handlers = this.evtListeners[sEvent];\n      if (!!handlers) {\n        var l = handlers.length;\n        for (var i = 0; i < l; i++) {\n          var item = handlers[i];\n          item.apply(this, [{ type: this.onICEList }]);\n        }\n      }\n    };\n\n    console.log(\"$xirsys.ice Loaded Successfuly!!!\");\n    _ice = null;\n\n    // Signal\n\n    var _sig = ($xirsys.signal = function (apiUrl, userName, info) {\n      if (!info) info = {};\n      this.info = info;\n      //internal values\n      this.sig = null; //local signal object.\n      this.tmpToken = null; //authorized token for signal calls\n      this.sigHostPath = null; //full authorized path to signaling service.\n      this.pendListeners = []; //event listener - hold until init.\n      this.heartbeat = null; //interval that keeps the signal open.\n      this.evtListeners = {};\n\n      //path to channel we are sending data to.\n      //this.channelPath = !!info.channel ? this.cleanChPath(info.channel) : '';\n\n      this.userName = !!userName ? userName : null;\n      this.apiUrl = !!apiUrl ? apiUrl : \"/webrtc\";\n      //console.log('*signal*  constructed');\n      this.connectTo(!!info.channel ? info.channel : \"\");\n    });\n\n    _sig.prototype.ver = \"v2\";\n    _sig.prototype.keepAliveInt = 800;\n    _sig.prototype.connected = false;\n\n    _sig.prototype.close = function () {\n      console.log(\"close \", this.sig);\n      if (this.heartbeat) this.stopHeart();\n      if (this.sig) this.sig.close();\n    };\n\n    _sig.prototype.connectTo = function (channel) {\n      this.channelPath = !!channel ? this.cleanChPath(channel) : \"\";\n      console.log(\"connectTo: \", this.channelPath);\n      //if connected stop current, then do new.\n      if (!!this.sig) {\n        this.close();\n        var own = this;\n        setTimeout(() => {\n          own.doToken();\n        }, 800);\n      } else if (!!this.apiUrl) {\n        //!!this.userName &&\n        if (this.info.ident && this.info.secret) {\n          this.doToken(this.info.ident, this.info.secret); //first get our token.\n        } else {\n          this.doToken();\n        }\n      } else {\n        console.log(\"Error: Could connect signal!\");\n      }\n      return true;\n    };\n\n    _sig.prototype.doToken = function (ident, secret) {\n      var path =\n        this.apiUrl + \"/_token\" + this.channelPath + \"?k=\" + this.userName;\n      console.log(\"*signal*  PUT doToken to \" + path);\n      var own = this;\n      var _headers = {};\n      if (ident && secret) {\n        _headers[\"Authorization\"] = \"Basic \" + btoa(ident + \":\" + secret);\n      }\n      $.ajax({\n        url: path,\n        type: \"PUT\",\n        dataType: \"json\",\n        headers: _headers,\n        error: function (data) {\n          console.log(\"*signal*  error: \", data);\n        },\n        success: function (data) {\n          own.tmpToken = data.v;\n          if (own.tmpToken === \"no_namespace\") {\n            console.log(\"*signal*  fail: \", own.tmpToken);\n            return;\n          }\n          console.log(\"*signal*  token: \", own.tmpToken);\n          if (own.info.ident && own.info.secret) {\n            own.doSignal(own.info.ident, own.info.secret); //first get our token.\n          } else {\n            own.doSignal();\n          }\n        },\n      });\n    };\n\n    _sig.prototype.doSignal = function (ident, secret) {\n      console.log(\n        \"*signal*  GET doSignal to \" +\n          this.apiUrl +\n          \"/_host\" +\n          this.channelPath +\n          \"?type=signal&k=\" +\n          this.userName\n      );\n      var own = this;\n      var path = this.info.channel\n        ? this.apiUrl +\n          \"/_host\" +\n          this.channelPath +\n          \"?type=signal&k=\" +\n          this.userName\n        : this.apiUrl + \"/_host?type=signal&k=\" + this.userName;\n      var _headers = {};\n      if (ident && secret) {\n        _headers[\"Authorization\"] = \"Basic \" + btoa(ident + \":\" + secret);\n      }\n      $.ajax({\n        url: path,\n        type: \"GET\",\n        dataType: \"json\",\n        headers: _headers,\n        error: function (data) {\n          console.log(\"*signal*  error: \", data);\n        },\n        success: function (data) {\n          own.host = data.v + \"/\" + own.ver + \"/\" + own.tmpToken;\n          console.log(\"KKKKKKKKK \", data);\n          if (data.randomUser) {\n            own.randomUser = data.randomUser;\n            setRandomUser(data.randomUser);\n          }\n\n          if (data.users) own.users = data.users;\n\n          console.log(\"signal host: \", own.host);\n          own.setupSocket();\n        },\n      });\n    };\n\n    //setup socket to signaling server.\n    _sig.prototype.setupSocket = function () {\n      console.log(\"*signal*  setupSocket to \" + this.host);\n      var own = this;\n      this.sig = new WebSocket(this.host);\n      //notify when connection is open\n      this.sig.addEventListener(\"open\", (evt) => {\n        own.startHeart();\n        own.connected = true;\n      });\n      //notify when connection closed\n      this.sig.addEventListener(\"close\", (evt) => {\n        if (this.heartbeat) own.stopHeart();\n        own.connected = false;\n        this.sig = null;\n      });\n\n      //add pending listeners to signaling object.\n      var l = this.pendListeners.length;\n      if (l > 0) {\n        for (var i = 0; i < l; i++) {\n          var item = this.pendListeners[i];\n          this.on(item.event, item.f);\n        }\n        this.pendListeners = [];\n      }\n      //notify when a message is received from signal network.\n      this.sig.addEventListener(\"message\", (msg) => {\n        var pkt = JSON.parse(msg.data);\n        console.log(\"*signal*  signal message! \", pkt);\n        var payload = pkt.p; //the actual message data sent\n        var meta = pkt.m; //meta object\n        var msgEvent = meta.o; //event label of message\n        // var toPeer = meta.t; //msg to user (if private msg)\n        var fromPeer = meta.f; //msg from user\n        if (!!fromPeer) {\n          //remove the peer path to display just the name not path.\n          var p = fromPeer.split(\"/\");\n          fromPeer = p[p.length - 1];\n        }\n        switch (msgEvent) {\n          //first connect, list of all peers connected.\n          case \"peers\":\n            //this is first call when you connect,\n            //  so we can check for channelPath here dynamically.\n            var sysNum = meta.f.lastIndexOf(\"__sys__\");\n            if (sysNum > -1 && !this.channelPath) {\n              own.channelPath = meta.f.substring(0, sysNum); //save message path for sending.\n              console.log(\"*signal*  channelPath \", this.channelPath);\n            }\n            //setUsers(payload.users);\n            break;\n          //new peer connected\n          case \"peer_connected\":\n            //addUser(fromPeer);\n            break;\n          //peer left.\n          case \"peer_removed\":\n            //removeUser(fromPeer);\n            break;\n          //message received. Call to display.\n          case \"message\":\n            //onUserMsg(payload.msg, fromPeer, toPeer);\n            var data = payload.msg;\n            data.f = fromPeer;\n            if (\n              data.type === \"candidate\" ||\n              data.type === \"offer\" ||\n              data.type === \"answer\" ||\n              data.type === \"custom\"\n            ) {\n              own.emit(data.type, data);\n            }\n            break;\n          default:\n            break;\n        }\n        own.emit(\"message\", msg.data);\n      });\n      //console.log('sig:  ',this.sig);\n    };\n    // User event, sends user message.\n    _sig.prototype.sendMessage = function (msg, toPeer, info) {\n      if (!info) info = {};\n      console.log(\n        \"*signal*  sendMessage: \",\n        msg,\n        \", to: \",\n        toPeer,\n        \" info: \",\n        info\n      );\n      if (msg === undefined || msg.length < 1) return;\n      var pkt = {\n        t: \"u\", // user message service\n        m: {\n          f: this.channelPath + this.userName,\n          o: !!info.m_event ? info.m_event : \"message\",\n        },\n        p: { msg: msg },\n      };\n      //if its to a peer, add direct message var (t) to meta object.\n      if (!!toPeer) pkt.m.t = toPeer;\n      //console.log('*signal*  sendMessage pkt: ',pkt);\n      this.sig.send(JSON.stringify(pkt));\n\n      return pkt;\n    };\n\n    //formats the custom channel path how we need it.\n    _sig.prototype.cleanChPath = function (path) {\n      //has slash at front\n      if (path.indexOf(\"/\") !== 0) path = \"/\" + path;\n      if (path.lastIndexOf(\"/\") === path.length - 1)\n        path = path.substr(0, path.lastIndexOf(\"/\"));\n      //console.log('cleanChPath new path: '+path);\n      return path;\n    };\n\n    //Keeps pinging signal server to keep connection alive.\n    _sig.prototype.startHeart = function () {\n      //console.log('*signal*  startHeart ',this.keepAliveInt);\n      if (!!this.heartbeat) clearInterval(this.heartbeat);\n      var own = this;\n      this.heartbeat = setInterval(function () {\n        own.sig.send(\"ping\");\n      }, $xirsys.signal.keepAliveInt);\n    };\n    _sig.prototype.stopHeart = function () {\n      clearInterval(this.heartbeat);\n      this.heartbeat = null;\n      //this.sig = null;\n      console.log(\"signal closed!\");\n    };\n\n    //events\n    _sig.prototype.on = function (sEvent, cbFunc) {\n      //console.log('*signal*  on ',sEvent,', func: '+cbFunc);\n      if (!sEvent || !cbFunc) {\n        console.log('error:  missing arguments for \"on\" event.');\n        return false;\n      }\n      //if event does not exist create it and give it an array for listeners.\n      if (!this.evtListeners[sEvent]) this.evtListeners[sEvent] = [];\n      //add listener to event.\n      this.evtListeners[sEvent].push(cbFunc);\n    };\n    _sig.prototype.off = function (sEvent, cbFunc) {\n      if (!this.evtListeners.hasOwnProperty(sEvent)) return false; //end\n\n      var index = this.evtListeners[sEvent].indexOf(cbFunc);\n      if (index !== -1) {\n        this.evtListeners[sEvent].splice(index, 1);\n        return true; //else end here.\n      }\n      return false; //else end here.\n    };\n\n    _sig.prototype.emit = function (sEvent, data) {\n      //console.log('*signal*  emit ',sEvent,', func: '+data);\n      var handlers = this.evtListeners[sEvent];\n      if (!!handlers) {\n        var l = handlers.length;\n        for (var i = 0; i < l; i++) {\n          var item = handlers[i];\n          item.apply(this, [{ type: sEvent, data: data }]);\n        }\n      }\n    };\n    console.log(\"$xirsys.signal Loaded Successfuly!!!\");\n    _sig = null;\n\n    // p2p\n\n    var _p2p = ($xirsys.p2p = function (signal, mediaStream, servers, info) {\n      if (!info) info = {};\n      //info can have TURN only filter.\n      console.log(\n        \"*p2p*  servers: \",\n        servers,\n        \", mediaStream: \",\n        mediaStream,\n        \", sig: \",\n        signal,\n        \", info: \",\n        info\n      );\n      this.evtListeners = {};\n      this.pc = null; //peer connection\n\n      var own = this;\n      this.sig = signal;\n      if (!!this.sig) {\n        this.sig.on(\"candidate\", (evt) => {\n          own.receiveCandidate(evt);\n        });\n        this.sig.on(\"offer\", (evt) => {\n          own.receiveOffer(evt);\n        });\n        this.sig.on(\"answer\", (evt) => {\n          own.receiveAnswer(evt);\n        });\n      }\n      this.servers = !!servers ? servers : {};\n      this.forceTurn = info.forceTurn != null ? info.forceTurn : false;\n      this.stream = mediaStream;\n      this.remotePeerID = null;\n      this.remoteStreams = {};\n\n      this.isCaller = null; //true / false\n      this.autoAnswer = info.autoAnswer != null ? info.autoAnswer : true;\n    });\n\n    _p2p.prototype.peerConnSuccess = \"peer.connect.success\";\n    _p2p.prototype.peerConnRequest = \"peer.connect.request\";\n    _p2p.prototype.iceDisconnected = \"peer.connect.disconnected\";\n\n    _p2p.prototype.close = function () {\n      if (this.pc) {\n        this.pc.close();\n      }\n      this.remoteStreams = {};\n      this.remotePeerID = null;\n      this.isCaller = null;\n    };\n    //used to update the media and renegociate p2p connection.\n    _p2p.prototype.updateMediaStream = function (mediaStream) {\n      console.log(\"*p2p*  updateMediaStream \", mediaStream);\n\n      this.stream = mediaStream;\n      if (!!this.pc && this.stream) {\n        this.isCaller = true;\n        const own = this;\n        // this.pc.addStream(this.stream);`\n        this.stream.getTracks().forEach((track) => {\n          own.pc.addTrack(track, own.stream);\n        });\n        this.pc\n          .createOffer()\n          .then((desc) => {\n            own.setLocalAndSendMessage(desc);\n          }) // success\n          .catch((err) => {\n            own.onCreateSessionDescriptionError(err);\n          }); // error\n      }\n      return true;\n    };\n    //calls peer @custID and estblishes a p2p connection.\n    _p2p.prototype.callPeer = function (custID) {\n      console.log(\"*p2p*  callPeer \", custID);\n      if (this.createPeerConnection() && this.stream) {\n        //this flag tells our code we are doing the calling.\n        console.log(\"this pc =>> \", this.pc, this);\n        this.isCaller = true;\n        const own = this;\n        this.remotePeerID = custID;\n        // this.pc.addStream(this.stream);\n        this.stream.getTracks().forEach((track) => {\n          own.pc.addTrack(track, own.stream);\n        });\n        this.pc\n          .createOffer()\n          .then((desc) => {\n            own.setLocalAndSendMessage(desc);\n          }) // success\n          .catch((err) => {\n            own.onCreateSessionDescriptionError(err);\n          }); // error\n      }\n    };\n\n    _p2p.prototype.receiveCandidate = function (evt) {\n      if (!this.pc) return false;\n      var iceCandidate = evt.data;\n      //console.log('*p2p*  receiveCandidate ',iceCandidate);\n      var rtcIceCandidate = new RTCIceCandidate(iceCandidate);\n      this.pc.addIceCandidate(rtcIceCandidate);\n    };\n\n    //user calles to accept offer when this has autoAnswer false\n    _p2p.prototype.acceptRequest = function (offer) {\n      //Pass offer to method with true which tells method offer was accepted.\n      this.receiveOffer(offer, true);\n    };\n\n    _p2p.prototype.receiveOffer = function (evt, isVerfied) {\n      var verified = isVerfied === true;\n      var desc = evt.data;\n      console.log(\n        \"*p2p*  receiveOffer \",\n        desc,\n        \" remotePeerID = \",\n        this.remotePeerID,\n        \"autoAnswer\",\n        this.autoAnswer\n      );\n      //if autoAnser is false, and this has not been verified, stop and emit request event.\n      if (!this.autoAnswer && !verified) {\n        console.log(\"needs verification!\");\n        this.emit(this.peerConnRequest, evt.data);\n        return;\n      }\n      var own = this;\n      //if autoAnser is false and has been verfied, OR autoAnswer is true then connect us.\n      if (!this.remotePeerID && !!desc.f) this.remotePeerID = desc.f;\n      console.log(\"*p2p*  !pc \", this.pc, \", !iscaller: \", this.isCaller);\n      if (!this.pc && !this.isCaller) {\n        if (this.createPeerConnection() && this.stream) {\n          // this.pc.addStream(this.stream);\n          this.stream.getTracks().forEach((track) => {\n            own.pc.addTrack(track, own.stream);\n          });\n        }\n      }\n\n      try {\n        this.pc.setRemoteDescription(new RTCSessionDescription(desc));\n      } catch (e) {\n        console.error(\"**P2p** setRemoteDescription offer ,\", e);\n      }\n\n      this.pc\n        .createAnswer()\n        .then((desc) => {\n          own.setLocalAndSendMessage(desc);\n        }) // success\n        .catch((err) => {\n          own.onCreateSessionDescriptionError(err);\n        }); // error\n    };\n\n    _p2p.prototype.receiveAnswer = function (evt) {\n      var desc = evt.data;\n      console.log(\"*p2p*  receiveAnswer \", desc);\n      if (this.remotePeerID !== desc.f) return; //not the droid were looking for.\n      try {\n        this.pc.setRemoteDescription(new RTCSessionDescription(desc));\n      } catch (e) {\n        console.error(\"**P2p** setRemoteDescription answer ,\", e);\n      }\n    };\n\n    _p2p.prototype.createPeerConnection = function () {\n      console.log(\"*p2p*  createPeerConnection \");\n      //if(!!this.pc) return true;\n      try {\n        var own = this;\n        console.log(\"RTCPeerConnection servers:  \", this.servers);\n        this.pc = new RTCPeerConnection(this.servers);\n\n        this.pc.ontrack = (event) => {\n          event.streams[0].getTracks().forEach((track) => {\n            console.log(rstream, \"rstreeeeem\");\n            rstream.addTrack(track);\n          });\n        };\n\n        this.pc.onicecandidate = function (evt) {\n          //send to peer\n          var cand = evt.candidate;\n          if (!cand) return;\n          if (own.forceTurn && cand.candidate.indexOf(\"typ relay\") === -1) {\n            cand = null;\n          } else {\n            //console.log('Is Turn: ',own.forceTurn,' Candidate: ',cand);\n            own.sig.sendMessage(\n              {\n                type: \"candidate\",\n                candidate: cand.candidate,\n                sdpMid: cand.sdpMid,\n                sdpMLineIndex: cand.sdpMLineIndex,\n              },\n              own.remotePeerID\n            );\n          }\n        };\n        // this.pc.onaddstream = (evt) => {\n        //   console.log(\"*p2p*  onaddstream \", evt);\n        //   own.addRemoteStream(evt.stream); //remoteStreams\n        // };\n        this.pc.onremovestream = (evt) =>\n          console.log(\"*p2p*  onremovestream \", evt);\n        this.pc.onconnectionstatechange = (evt) =>\n          console.log(\n            \"*p2p*  onconnectionstatechange: \" + own.pc.connectionState\n          );\n        this.pc.oniceconnectionstatechange = (evt) => {\n          console.log(\n            \"*p2p*  oniceconnectionstatechange: \" + own.pc.iceConnectionState\n          );\n\n          // this.pc.ontrack = (event) => {\n          //   event.streams[0].getTracks().forEach((track) => {\n          //     own.addTrack(track);\n          //   });\n          // };\n\n          switch (own.pc.iceConnectionState) {\n            case \"checking\":\n              break;\n            case \"connected\":\n              break;\n            case \"disconnected\":\n              own.emit(own.iceDisconnected, own.remotePeerID);\n              break;\n            case \"failed\":\n              break;\n            case \"closed\":\n              own.pc = null;\n              console.log(\"pc: \", own.pc);\n              break;\n            default:\n              break;\n          }\n        };\n        return true;\n      } catch (e) {\n        console.log(\"Failed to create PeerConnection, exception: \" + e.message);\n        return false;\n      }\n    };\n\n    _p2p.prototype.hangup = function (callId) {\n      console.log(\"*p2p*  hangup\", callId);\n      //var stream = this.remoteStreams[callId];\n      this.pc.close();\n      this.remoteStreams[callId] = null;\n      this.remotePeerID = null;\n      this.isCaller = false;\n      //if no streams close and nulify pc.\n      //this.pc = null;\n    };\n\n    _p2p.prototype.addTrack = function (track) {\n      this.remoteStreams[this.remotePeerID] = track;\n      this.emit(this.peerConnSuccess, this.remotePeerID);\n      this.isCaller = false;\n    };\n\n    _p2p.prototype.addRemoteStream = function (remoteStream) {\n      this.remoteStreams[this.remotePeerID] = remoteStream;\n      this.emit(this.peerConnSuccess, this.remotePeerID);\n      this.isCaller = false;\n    };\n\n    _p2p.prototype.getLiveStream = function (remotePeerID) {\n      return this.remoteStreams[remotePeerID];\n    };\n\n    _p2p.prototype.setLocalAndSendMessage = function (sessionDescription) {\n      console.log(\n        \"*p2p*  setLocalAndSendMessage sending message\",\n        sessionDescription\n      );\n      this.pc.setLocalDescription(sessionDescription);\n      //sendMessage(sessionDescription);\n      console.log(\"sendMessage for: \", this.remotePeerID);\n      this.sig.sendMessage(sessionDescription, this.remotePeerID);\n    };\n\n    _p2p.prototype.onCreateSessionDescriptionError = function (error) {\n      console.log(\"Failed to create session description: \", error);\n    };\n\n    /* EVENTS */\n\n    _p2p.prototype.on = function (sEvent, cbFunc) {\n      //console.log('*p2p*  on ',sEvent,', func: '+cbFunc);\n      if (!sEvent || !cbFunc) {\n        console.log(\"error:  missing arguments for on event.\");\n        return false;\n      }\n      if (!this.evtListeners[sEvent]) this.evtListeners[sEvent] = [];\n      this.evtListeners[sEvent].push(cbFunc);\n    };\n    _p2p.prototype.off = function (sEvent, cbFunc) {\n      console.log(\"off\");\n      this.evtListeners.push(cbFunc);\n    };\n\n    _p2p.prototype.emit = function (sEvent, data) {\n      var handlers = this.evtListeners[sEvent];\n      if (!!handlers) {\n        var l = handlers.length;\n        for (var i = 0; i < l; i++) {\n          var item = handlers[i];\n          item.apply(this, [{ type: sEvent, data: data }]);\n        }\n      }\n    };\n\n    console.log(\"$xirsys.p2p Loaded Successfuly!!!\");\n    _p2p = null;\n  }, []);\n\n  return { xirsys: $xirsys };\n}\n\nexport default Xirsys;\n","import $ from \"jquery\";\nimport Xirsys from \"./Xirsys\";\nimport { useState, useEffect } from \"react\";\n\nfunction Main() {\n  // const location = {};\n\n  //custom: check URL for \"ch\" var, and set the channel accourdingly\n  var channelPath = \"\"; //set this variable to specify a channel path\n  // var ch = decodeURI(\n  //   (RegExp(\"ch\" + \"=\" + \"(.+?)(&|$)\").exec(location.search) || [, null])[1]\n  // );\n  // if (ch != \"null\") channelPath = ch;\n  console.log(\"channel path: \", channelPath);\n\n  var mediaConstraints = {\n    audio: true,\n  };\n\n  const [lstream, setLStream] = useState(null);\n  const [rstream, setRStream] = useState(new MediaStream());\n  const [username, setUsername] = useState(null);\n  const [remoteCallID, setRemoteCallID] = useState(null);\n\n  const [startCall, setStartCall] = useState(false);\n\n  const [peer, setPeer] = useState(null);\n  const [sig, setSig] = useState(null);\n  const [media, setMedia] = useState(null);\n  const [ice, setIce] = useState(null);\n\n  const [call, setCall] = useState(false);\n  const [inCall, setInCall] = useState(false);\n\n  const { xirsys } = Xirsys(setRemoteCallID, rstream);\n\n  const [$xirsys, setXirsys] = useState(xirsys);\n\n  useEffect(() => {\n    if (lstream) {\n      //create signal if null\n      if (!sig)\n        setSig(\n          new $xirsys.signal(\"/webrtc\", username, { channel: channelPath })\n        );\n      //if the peer is created, update our media\n      if (!!peer) peer.updateMediaStream(lstream);\n    }\n  }, [lstream, sig]);\n\n  useEffect(() => {\n    if (peer) {\n      peer.on(peer.peerConnSuccess, onStartCall);\n      console.log(\"peer \", peer);\n    }\n    console.log(\"peer \", peer);\n  }, [peer]);\n\n  useEffect(() => {\n    if (call) {\n      callRemotePeer();\n      setCall(false);\n    }\n  }, [call]);\n\n  useEffect(() => {\n    if (sig) doSignal();\n  }, [sig]);\n\n  useEffect(() => {\n    if (media) getMyMedia();\n  }, [media]);\n\n  useEffect(() => {\n    if (ice) ice.on(ice.onICEList, onICE);\n  }, [ice]);\n\n  // const [interval, setInter] = useState(null);\n  // const intervalIce = () => {\n  //   ice.on(ice.onICEList, onICE);\n  // };\n\n  // useEffect(() => {\n  //   if (ice) {\n  //     if (rstream && !rstream.active) setInter(setInterval(intervalIce, 1000));\n  //     else if (interval && rstream && rstream.active) {\n  //       clearInterval(interval);\n  //       setInter(null);\n  //     }\n  //   }\n  // }, [rstream, ice]);\n\n  useEffect(() => {\n    console.log(\"remote Id == \", remoteCallID);\n\n    if (sig && remoteCallID && remoteCallID !== username) doSignal();\n  }, [remoteCallID]);\n  //if there is no remoteCallID show sharable link to call user.\n\n  function callRemotePeer() {\n    if (!!remoteCallID) {\n      console.log(\"Calling \" + remoteCallID);\n      peer.callPeer(remoteCallID);\n    } else {\n      console.log(\"Error\", \"A remote peer was not found!\");\n    }\n  }\n\n  // Get Xirsys ICE (STUN/TURN)\n  function doICE() {\n    console.log(\"doICE \");\n    if (!ice) {\n      setIce(new $xirsys.ice(\"/webrtc\", { channel: channelPath }));\n      //   ice.on(ice.onICEList, onICE);\n    }\n  }\n\n  function onICE(evt) {\n    console.log(\"onICE \", evt);\n    if (evt.type === ice.onICEList) {\n      //   getMyMedia();\n      setMedia(new $xirsys.media());\n    }\n  }\n\n  //Get local user media\n  function getMyMedia() {\n    console.log(\"getMyMedia()\");\n    //setup media\n    // if (!media) {\n    //   media = new $xirsys.media();\n    media.on(media.DEVICES_UPDATED, onMediaDevices); //returns list of media devices on local user machine.\n    media.on(media.ON_LOCAL_STREAM, onMediaDevices); //returns a/v stream of local user.\n    // }\n    //gets stream object of local users a/v\n    media\n      .getUserMedia(mediaConstraints, setLocalStream)\n      .then((str) => {\n        console.log(\"*main*  getUser Media stream: \", str);\n\n        // setLocalStream(str);\n        //create signal if null\n        // if (!sig) doSignal();\n        // //if the peer is created, update our media\n        // if (!!peer) peer.updateMediaStream(lstream);\n      })\n      .catch((err) => {\n        console.log(\"Could not get Media: \", err);\n        alert(\"Could not get Media!! Please check your camera and mic.\");\n      });\n  }\n\n  //Get Xirsys Signaling service\n  function doSignal() {\n    sig.on(\"message\", (msg) => {\n      let pkt = JSON.parse(msg.data);\n\n      console.log(\"message log ,\", msg, $xirsys);\n\n      let payload = pkt.p; //the actual message data sent\n      let meta = pkt.m; //meta object\n      let msgEvent = meta.o; //event label of message\n      // let toPeer = meta.t; //msg to user (if private msg)\n      let fromPeer = meta.f; //msg from user\n      //remove the peer path to display just the name not path.\n      if (!!fromPeer) {\n        let p = fromPeer.split(\"/\");\n        fromPeer = p[p.length - 1];\n      }\n      switch (msgEvent) {\n        //first Connect Success!, list of all peers connected.\n        case \"peers\":\n          //this is first call when you connect,\n          onReady();\n          // if we are connecting to a remote user and remote\n          // user id is found in the list then initiate call\n          if (!!remoteCallID) {\n            let users = payload.users;\n            if (users.indexOf(remoteCallID) > -1) {\n              setCall(true);\n            }\n          }\n          break;\n        //peer gone.\n        case \"peer_removed\":\n          if (fromPeer === remoteCallID) onStopCall();\n          break;\n\n        // new peer connected\n        //case \"peer_connected\":\n        // \taddUser(fromPeer);\n        // \tbreak;\n        // message received. Call to display.\n        //case 'message':\n        // \tonUserMsg(payload.msg, fromPeer, toPeer);\n        // \tbreak;\n        default:\n          break;\n      }\n    });\n  }\n\n  //Ready - We have our ICE servers, our Media and our Signaling.\n  function onReady() {\n    console.log(\"* onReady!\");\n    // setup peer connector, pass signal, our media and iceServers list.\n    let isTURN = getURLParameter(\"isTURN\") === \"true\"; //get force turn var.\n    console.log(\"isTURN \", isTURN);\n    setPeer(\n      new $xirsys.p2p(\n        sig,\n        lstream,\n        !ice ? {} : { iceServers: ice.iceServers },\n        { forceTurn: isTURN }\n      )\n    );\n    //add listener when a call is started.\n  }\n  // A peer call started udpate the UI to show remote video.\n  function onStartCall(evt) {\n    console.log(\"*main*  onStartCall \", evt);\n    let remoteId = evt.data;\n    console.log(\"peer scall \", peer);\n    setRemoteStream(peer.getLiveStream(remoteId));\n    //   shareTitleEl.innerHTML = \"In call with user:\";\n    setRemoteCallID(remoteId);\n    setInCall(true);\n  }\n\n  function onStopCall() {\n    console.log(\"*main*  onStopCall \");\n    if (inCall) {\n      peer.hangup(remoteCallID);\n    }\n    setInCall(false);\n    setRemoteCallID(null);\n    setIce(null);\n    // setPeer(null);\n    // setMedia(null);\n    setSig(null);\n    setStartCall(false);\n    // setLStream(null);\n    // setRStream(new MediaStream());\n\n    console.log($xirsys);\n\n    // setXirsys(null);\n  }\n\n  /* UI METHODS */\n\n  //sets local user media to video object.\n  function setLocalStream(str) {\n    console.log(\"*main*  setLocalStream & Video obj \", str);\n    // localStream = str;\n    setLStream(str);\n    // localVideoEl.srcObject = str;\n  }\n  //sets remote user media to video object.\n  function setRemoteStream(str) {\n    console.log(\"*main*  setRemoteStream & Video obj \", str);\n    // remoteStream = str;\n    console.log($xirsys.pc, \"PC\");\n    // $xirsys.pc.ontrack = (event) => {\n    //   event.streams[0].getTracks().forEach((track) => {\n    //     rstream.addTrack(track);\n    //   });\n    // };\n    // setRStream(str);\n    setStartCall(true);\n  }\n  //update the list of media sources on UI\n  function onMediaDevices(e) {\n    console.log(\"*main*  onMediaDevices: \", e, \" data: \", e.data);\n    switch (e.type) {\n      case media.DEVICES_UPDATED:\n        updateDevices(e.data);\n        break;\n      case media.ON_LOCAL_STREAM:\n        //update list with selected.\n        setSelectedDevices(e.data.getTracks());\n        break;\n      default:\n        break;\n    }\n  }\n\n  function updateDevices(devices) {\n    const mics = devices.audioin,\n      cams = devices.videoin;\n    console.log(\"*main*  updateDevices - mics:\", mics, \", cams:\", cams);\n    const camList = $(\"#ctrlMenu #camList\"),\n      micList = $(\"#ctrlMenu #micList\");\n    //camToggle = $('#ctrlMenu #camToggle'),\n    //micToggle = $('#ctrlMenu #micToggle');\n\n    micList.empty();\n    mics.forEach((device) => {\n      micList.append(\n        '<li><a id=\"' +\n          device.deviceId +\n          '\" data-group-id=\"' +\n          device.groupId +\n          '\" class=\"btn\" role=\"button\">' +\n          device.label +\n          \"</a></li>\"\n      );\n    });\n\n    camList.empty();\n    cams.forEach((device) => {\n      camList.append(\n        '<li><a id=\"' +\n          device.deviceId +\n          '\" data-group-id=\"' +\n          device.groupId +\n          '\" class=\"btn\" role=\"button\">' +\n          device.label +\n          \"</a></li>\"\n      );\n    });\n  }\n\n  function setSelectedDevices(devices) {\n    console.log(\"*main*  setSelectedDevices: \", devices);\n    //console.log('- video: ',devices.getVideoTracks() );\n    devices.forEach((device) => {\n      switch (device.kind) {\n        case \"audio\":\n          console.log(\"- audio toggel: \", device);\n          $(\"#ctrlMenu #micToggle\").html(\n            device.label.substr(0, 20) + '<span class=\"caret\"></span>'\n          );\n          break;\n        case \"video\":\n          console.log(\"- video toggel: \", device);\n          $(\"#ctrlMenu #camToggle\").html(\n            device.label.substr(0, 20) + '<span class=\"caret\"></span>'\n          );\n          break;\n        default:\n          break;\n      }\n    });\n  }\n\n  /* TOOLS */\n\n  // function hasMedia(label, tracks) {\n  //   console.log(\"tracks: \", tracks, \", label: \", label);\n  //   let l = tracks.length,\n  //     i,\n  //     hasIt = false;\n  //   for (i = 0; i < l; i++) {\n  //     let track = tracks[i];\n  //     if (track.label.indexOf(label) > -1) {\n  //       hasIt = true;\n  //       break;\n  //     }\n  //   }\n  //   return hasIt;\n  // }\n\n  //gets URL parameters\n  function getURLParameter(name) {\n    var url_string = window.location.href;\n    var url = new URL(url_string);\n    var c = url.searchParams.get(name);\n\n    return c ? c : null;\n  }\n  //makes unique userid\n  function guid(s = \"user\") {\n    function s4() {\n      return Math.floor((1 + Math.random()) * 0x10000)\n        .toString(16)\n        .substring(1);\n    }\n    return s + s4() + s4();\n  }\n\n  const onLoad = () => {\n    console.log(\"pretty loaded!!\");\n    if (!username) setUsername(guid()); //create random local username\n    let urlName = getURLParameter(\"callid\"); //get call id if exists from url\n    if (!!urlName) {\n      setRemoteCallID(urlName);\n    }\n\n    //get Xirsys service\n    doICE();\n  };\n\n  return {\n    onLoad,\n    lstream,\n    rstream,\n    onStopCall,\n    startCall,\n  };\n}\nexport default Main;\n\n// export const stream = { localStream, remoteStream };\n","import React, { useEffect, useState } from \"react\";\nimport Loader from \"react-loader-spinner\";\nimport WaveAudio from \"./WaveAudio\";\n\nimport Main from \"../hooks/Main1\";\n\nfunction Audio({ type = 0, answer }) {\n  const { onLoad, lstream, rstream, onStopCall, startCall } = Main();\n\n  useEffect(() => {\n    console.log(\"Type is ==> \", type, startCall);\n    if (type === 0) {\n      stopAudioOnly(lstream);\n      stopAudioOnly(rstream);\n      if (startCall) onStopCall();\n    }\n    if (type === 1) {\n      onLoad();\n    }\n  }, [type]);\n\n  useEffect(() => {\n    if (startCall) {\n      answer();\n    }\n  }, [startCall]);\n\n  // useEffect(() => {\n  //   console.log(\"r ===>> \", rstream);\n  //   if (rstream.active) {\n  //     answer();\n  //   }\n  // }, [rstream]);\n\n  const [interval, setInter] = useState(null);\n  const [cnt, setCnt] = useState(0);\n\n  const intervalAnswer = () => {\n    // console.log(\"set cnt \", cnt);\n    setCnt((c) => c + 1);\n  };\n\n  useEffect(() => {\n    if (type === 1) setInter(setInterval(intervalAnswer, 1000));\n    else if (interval) {\n      clearInterval(interval);\n      setInter(null);\n    }\n  }, [type, rstream]);\n\n  useEffect(() => {\n    console.log(\"rstream s ===>> \", rstream);\n    if (rstream) {\n      if (rstream.active) {\n        console.log(\"answer call\");\n        // setStream(rstream);\n        answer();\n      } else if (!rstream.active) {\n        // setCnt((c) => c + 1);\n      }\n    }\n    // console.log(\"cntttt \", cnt);\n    // if (cnt === 4) {\n    //   onStopCall();\n    // } else if (cnt === 5) {\n    //   setCnt(0);\n    //   onLoad();\n    // }\n  }, [cnt]);\n\n  return type === 1 ? (\n    <Loader type=\"Bars\" color=\"rgba(102, 193, 113, 1)\" height={80} width={80} />\n  ) : type === 2 && rstream ? (\n    <WaveAudio stream={rstream} lstream={lstream} />\n  ) : (\n    <div></div>\n  );\n}\n\nexport default Audio;\n\nfunction stopAudioOnly(stream) {\n  if (stream) {\n    stream.getTracks().forEach(function (track) {\n      track.stop();\n      console.log(\"st\", stream);\n    });\n  }\n}\n","import { useState } from \"react\";\n\nfunction Call() {\n  const [state, setState] = useState(0);\n  const [btnText, setBtnText] = useState(\"Call\");\n\n  const click = function () {\n    state === 0 && (setState(1) || setBtnText(\"Dialling\"));\n    state === 1 && (setState(0) || setBtnText(\"Call\"));\n    // state === 1 && (setState(2) || setBtnText(\"End\"));\n    state === 2 && (setState(0) || setBtnText(\"Call\"));\n  };\n\n  const answer = function () {\n    setState(2);\n    setBtnText(\"End\");\n  };\n\n  return { state, click, btnText, answer };\n}\n\nexport default Call;\n","import React from \"react\";\nimport Audio from \"./component/Audio\";\nimport Call from \"./hooks/Call\";\n\nfunction App() {\n  const { state, click, btnText, answer } = Call();\n\n  return (\n    <div className=\"App\">\n      <div className=\"logo\">\n        <h4>TalkTime</h4>\n      </div>\n      <div>\n        <h5>Find someone to talk to.</h5>\n      </div>\n      <div className=\"audio-animation\">\n        <Audio type={state} answer={answer} />\n      </div>\n      <div className=\"button\">\n        <button onClick={click} className={btnText}>\n          {btnText}\n        </button>\n      </div>\n      <div className=\"footer\">\n        <a href=\"/privacy\">Privacy Policy</a> | <a href=\"/terms\">Terms</a>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}